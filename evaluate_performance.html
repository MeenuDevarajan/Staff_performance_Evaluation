{% extends 'staff_app/base.html' %}

{% block content %}
<h1>Performance of Staffs</h1>

<form method="post">
    {% csrf_token %}
    
    <div style="margin: 15px 0;">
        <label><strong>Total Hours Worked:</strong></label>
        <input type="number" name="total_hours" step="0.1" min="0" max="24" value="8" required 
               style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 200px;">
    </div>
    
    <div style="margin: 15px 0;">
        <label><strong>Activity Percentage:</strong></label>
        <input type="number" name="activity_percentage" step="0.1" min="0" max="100" value="80" required
               style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 200px;">
    </div>
    
    <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Evaluate Performance (ML)
    </button>
</form>

<!-- ML Prediction Result -->
{% if score %}
<div style="background: #d4edda; padding: 20px; margin-top: 20px; border-radius: 5px;">
    <h3>
        ü§ñ ML Performance Prediction 
        {% if ml_used %}
        <span style="font-size: 14px; color: #28a745;">(AI Powered)</span>
        {% endif %}
    </h3>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
        <div style="background: white; padding: 15px; border-radius: 5px;">
            <strong>Hours Worked:</strong> {{ total_hours }}h
        </div>
        <div style="background: white; padding: 15px; border-radius: 5px;">
            <strong>Activity Level:</strong> {{ activity_percentage }}%
        </div>
        <div style="background: white; padding: 15px; border-radius: 5px;">
            <strong>ML Score:</strong> {{ score }}/10
        </div>
        <div style="background: white; padding: 15px; border-radius: 5px;">
            <strong>Rating:</strong> 
            {% if score >= 8 %}
            <span style="color: green;">Excellent üéâ</span>
            {% elif score >= 6 %}
            <span style="color: orange;">Good üëç</span>
            {% else %}
            <span style="color: red;">Needs Improvement üìà</span>
            {% endif %}
        </div>
    </div>
    
    <!-- Progress Bar -->
    <div style="background: #ddd; height: 20px; margin: 10px 0; border-radius: 10px;">
        <div style="background: #007bff; height: 100%; width: {{ score }}0%; border-radius: 10px;"></div>
    </div>
</div>
{% endif %}

<!-- Staff Performance Graph -->
{% if performance_data %}
<div style="background: #e7f3ff; padding: 20px; margin-top: 20px; border-radius: 5px;">
    <h3>üìä Staff Performance Comparison</h3>
    
    <!-- Bar Graph -->
    <div style="display: flex; align-items: end; height: 250px; gap: 20px; margin: 20px 0; padding: 20px; background: white; border: 1px solid #ddd;">
        <!-- Y-axis -->
        <div style="display: flex; flex-direction: column; justify-content: space-between; height: 100%; margin-right: 10px; font-weight: bold;">
            <span>10</span>
            <span>8</span>
            <span>6</span>
            <span>4</span>
            <span>2</span>
            <span>0</span>
        </div>
        
        <!-- Bars -->
        {% for data in performance_data %}
        <div style="text-align: center;">
            <div style="background: 
                {% if data.performance_score >= 8 %}#28a745
                {% elif data.performance_score >= 6 %}#ffc107
                {% else %}#dc3545{% endif %}; 
                width: 35px; 
                height: {% if data.performance_score %}{{ data.performance_score|floatformat:0 }}0px{% else %}50px{% endif %};
                border-radius: 5px 5px 0 0;">
            </div>
            <div style="margin-top: 10px; font-size: 12px; font-weight: bold;">
                {{ data.employee.name|default:"User" }}
            </div>
            <div style="font-size: 11px;">
                {% if data.performance_score %}
                    {{ data.performance_score|floatformat:1 }}
                {% else %}
                    N/A
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Error Message -->
{% if error %}
<div style="background: #f8d7da; color: #721c24; padding: 15px; margin-top: 20px; border-radius: 5px;">
    <strong>Error:</strong> {{ error }}
</div>
{% endif %}

<!-- Test Data Suggestions -->
<div style="background: #f8f9fa; padding: 15px; margin-top: 20px; border-radius: 5px;">
    <h4>üß™ Test ML with these values:</h4>
    <ul>
        <li><strong>High Performance:</strong> 9h, 90% ‚Üí ~8.7-9.2</li>
        <li><strong>Good Performance:</strong> 7h, 75% ‚Üí ~7.0-7.5</li>
        <li><strong>Average Performance:</strong> 6h, 65% ‚Üí ~6.0-6.5</li>
        <li><strong>Low Performance:</strong> 4h, 50% ‚Üí ~4.0-4.5</li>
    </ul>
</div>
{% endblock %}